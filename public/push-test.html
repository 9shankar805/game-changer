<!DOCTYPE html>
<html>
<head>
    <title>Background Push Test</title>
</head>
<body>
    <h1>Background Push Notifications</h1>
    <button onclick="enablePush()">Enable Push</button>
    <button onclick="sendPush()">Send Background Push</button>
    
    <script>
        async function enablePush() {
            await Notification.requestPermission();
            const registration = await navigator.serviceWorker.register('/sw.js');
            const subscription = await registration.pushManager.subscribe({
                userVisibleOnly: true,
                applicationServerKey: 'BG5V1u2eNls8IInm93_F-ZBb2hXaEZIy4AjHBrIjDeClqi4wLVlVZ5x64WeMzFESgByQjeOtcL1UrGMGFQm0GlE'
            });
            
            await fetch('/api/push/subscribe', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ subscription, userId: 'test' })
            });
            
            alert('Push enabled! Close this tab and notifications will still work.');
        }
        
        async function sendPush() {
            await fetch('/api/test/simple-push', { method: 'POST' });
        }
    </script>
</body>
</html>